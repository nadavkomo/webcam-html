<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera</title>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>

<body>
    <div class="container">

        <div class="camera">
            <div class="app__input">
                <button onclick="takePicture()">Take a picture</button>
                <button><input type="file" onchange="onFileSelected(event)" /></button>
            </div>
            <div class="btns-action">
                <button onclick="changeAcion('none')">STOP</button>
                <button onclick="changeAcion('Running')">RUN</button>
                <button onclick="changeAcion('Wave')">WAVE</button>
            </div>
            <div class="btns-position">
                <button onclick="changePositionTop()">Up</button>
                <section>
                    <button onclick="changePositionLeft()">Left</button>
                    <button onclick="changePositionRight()">Right</button><br>
                </section>
                <button onclick="changePositionBottom()">Down</button>
            </div>
            <div class="camera-container">
                <div class="app__container">
                    <video muted autoPlay class="app__videoFeed"></video>
                    <div class="demo">
                        <model-viewer id="model1" src="./RobotExpressive.glb" camera-controls autoplay
                            animation-name="none" ar>
                        </model-viewer>
                    </div>
                </div>
                <div class="screenshot">
                    <img id="myimage" src="./default.png" alt="" />
                    <div class="demo">
                        <model-viewer id="model2" src="./RobotExpressive.glb" camera-controls autoplay
                            animation-name="none" ar>
                        </model-viewer>
                    </div>
                </div>
            </div>
            <canvas class="canvas" height=500 width=500></canvas>
        </div>
    </div>
    <script>
        var video = document.getElementsByClassName('app__videoFeed')[0];
        var mode = { facingMode: 'environment' }
        function startVideo() {
            console.log('start');
            navigator.getUserMedia(
                {
                    video: mode
                },
                (stream) => {
                    if (video) {
                        video.srcObject = stream;
                    }
                },
                (err) => console.error(err)
            );
        }
        startVideo()
        function changeCamera() {
            if (mode === { facingMode: 'user' }) mode = { facingMode: 'environment' }
            else mode = { facingMode: 'user' }
            console.log(mode);
        }

        // const handleChange = ({ target }) => {
        //     const file = target.files[0]
        //     if (file) {
        //         const reader = new FileReader();
        //         reader.addEventListener("load", function () {
        //             console.log(this);
        //             setUrl(this.result)
        //         })
        //         reader.readerAsDataURL(file);
        //     }
        // }

        function takePicture() {
            var canvas = document.querySelector('canvas')
            canvas.style.display = 'none'
            var context = canvas.getContext('2d')
            context.drawImage(video, 0, 0, 500, 500)
            // context.drawImage(lion, 0, 0, 100, 100)
            make_base();
        }

        function make_base() {
            var canvas = document.querySelector('.canvas')
            var context = canvas.getContext('2d')
            var imgtag = document.getElementById("myimage");
            imgtag.src = canvas.toDataURL()
        }

        function onFileSelected(event) {
            var selectedFile = event.target.files[0];
            var reader = new FileReader();

            var imgtag = document.getElementById("myimage");
            imgtag.title = selectedFile.name;

            reader.onload = function (event) {
                imgtag.src = event.target.result;
            };

            reader.readAsDataURL(selectedFile);
        }

        function changeAcion(action) {
            var modelViewer1 = document.getElementById('model1')
            var modelViewer2 = document.getElementById('model2')
            modelViewer1.animationName = action
            modelViewer2.animationName = action
        }
        function changePositionRight() {
            var demo1 = document.querySelector('.app__container .demo')
            var modelViewer2 = document.getElementById('model2')
            var leftNumbers = demo1.style.left.replace('px', '')
            console.log(+leftNumbers);
            if (+leftNumbers > 350) {
                demo1.style.left = '0px'
                modelViewer2.style.left = '0px'
            }
            else {
                demo1.style.left = +leftNumbers + 50 + 'px'
                modelViewer2.style.left = +leftNumbers + 50 + 'px'
            }
        }
        function changePositionLeft() {
            var demo1 = document.querySelector('.app__container .demo')
            var modelViewer2 = document.getElementById('model2')
            var leftNumbers = demo1.style.left.replace('px', '')
            console.log(+leftNumbers);
            if (+leftNumbers === 0) {
                demo1.style.left = '400px'
                modelViewer2.style.left = '400px'
            }
            else {
                demo1.style.left = +leftNumbers - 50 + 'px'
                modelViewer2.style.left = +leftNumbers - 50 + 'px'
            }
        }
        function changePositionTop() {
            var demo1 = document.querySelector('.app__container .demo')
            var modelViewer2 = document.getElementById('model2')
            var leftNumbers = demo1.style.top.replace('px', '')
            console.log(+leftNumbers);
            if (+leftNumbers < 50) {
                demo1.style.top = '240px'
                modelViewer2.style.top = '240px'
            }
            else {
                demo1.style.top = +leftNumbers - 50 + 'px'
                modelViewer2.style.top = +leftNumbers - 50 + 'px'
            }
        }
        function changePositionBottom() {
            var demo1 = document.querySelector('.app__container .demo')
            var modelViewer2 = document.getElementById('model2')
            var leftNumbers = demo1.style.top.replace('px', '')
            console.log(+leftNumbers);
            if (+leftNumbers > 200) {
                demo1.style.top = '0px'
                modelViewer2.style.top = '0px'
            }
            else {
                demo1.style.top = +leftNumbers + 50 + 'px'
                modelViewer2.style.top = +leftNumbers + 50 + 'px'
            }
        }

    </script>
</body>

</html>